<!DOCTYPE html>
<html lang="tr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Asteroid Shooter - Alienes.me</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800&display=swap"
        rel="stylesheet">
    <style>
        body {
            margin: 0;
            overflow: hidden;
            font-family: 'Outfit', sans-serif;
            background: #000;
            cursor: crosshair;
        }

        #ui-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            padding: 20px;
            box-sizing: border-box;
        }

        #score {
            color: #fff;
            font-size: 2rem;
            font-weight: 700;
            text-shadow: 0 0 10px #ff0000;
        }

        #health-bar {
            width: 300px;
            height: 20px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            overflow: hidden;
        }

        #health-fill {
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, #ff0000, #ff8800);
            transition: width 0.2s;
        }

        #game-over {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            background: rgba(0, 0, 0, 0.8);
            padding: 40px;
            border-radius: 20px;
            border: 2px solid #ff0000;
            display: none;
            pointer-events: auto;
            backdrop-filter: blur(10px);
        }

        .btn {
            background: linear-gradient(45deg, #ff0000, #ff8800);
            border: none;
            padding: 15px 40px;
            color: #fff;
            font-weight: 800;
            font-size: 1.2rem;
            border-radius: 50px;
            cursor: pointer;
            margin-top: 20px;
            transition: transform 0.2s, box-shadow 0.2s;
            text-transform: uppercase;
        }

        .btn:hover {
            transform: scale(1.05);
            box-shadow: 0 0 20px #ff0000;
        }

        #start-screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            pointer-events: auto;
            z-index: 10;
        }

        #crosshair {
            position: absolute;
            top: 50%;
            left: 50%;
            width: 20px;
            height: 20px;
            border: 2px solid rgba(255, 255, 255, 0.5);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            pointer-events: none;
        }
    </style>
</head>

<body>
    <div id="ui-container">
        <div class="flex justify-between items-start w-full">
            <div id="score">SKOR: 0</div>
            <div id="health-bar">
                <div id="health-fill"></div>
            </div>
        </div>
        <div class="text-white/50 text-sm">
            <a href="/" class="hover:text-white transition-colors pointer-events-auto">← Çıkış</a>
        </div>
    </div>

    <div id="crosshair"></div>

    <div id="start-screen">
        <h1
            class="text-6xl font-black text-transparent bg-clip-text bg-gradient-to-r from-red-500 to-orange-600 mb-4 filter drop-shadow-lg">
            ASTEROID SHOOTER</h1>
        <p class="text-gray-300 mb-8 text-xl">Dünyayı Koru</p>
        <div class="text-gray-400 mb-8">
            <p>Mouse ile nişan al, Tıkla ve Ateş Et!</p>
        </div>
        <button class="btn" onclick="startGame()">GÖREVE BAŞLA</button>
    </div>

    <div id="game-over">
        <h2 class="text-4xl font-bold text-white mb-2">GÖREV BAŞARISIZ</h2>
        <p class="text-red-300 text-xl mb-6">Skorun: <span id="final-score">0</span></p>
        <button class="btn" onclick="resetGame()">TEKRAR DENE</button>
        <br>
        <a href="/" class="inline-block mt-4 text-gray-400 hover:text-white text-sm">Menüye Dön</a>
    </div>

    <script>
        // Game Variables
        let scene, camera, renderer;
        let asteroids = [];
        let lasers = [];
        let particles = [];
        let score = 0;
        let health = 100;
        let isPlaying = false;
        let animationId;
        let mouse = new THREE.Vector2();
        let raycaster = new THREE.Raycaster();

        // Settings
        const ASTEROID_SPEED = 0.3; // Reduced from 0.5
        const LASER_SPEED = 2;

        // Audio Engine
        const Audio = {
            ctx: null,
            init() {
                try {
                    window.AudioContext = window.AudioContext || window.webkitAudioContext;
                    this.ctx = new AudioContext();
                } catch (e) { console.warn('Web Audio API not supported'); }
            },
            playTone(freq, type, duration, vol = 0.1) {
                if (!this.ctx) return;
                const osc = this.ctx.createOscillator();
                const gain = this.ctx.createGain();
                osc.type = type;
                osc.frequency.setValueAtTime(freq, this.ctx.currentTime);
                gain.gain.setValueAtTime(vol, this.ctx.currentTime);
                gain.gain.exponentialRampToValueAtTime(0.01, this.ctx.currentTime + duration);
                osc.connect(gain);
                gain.connect(this.ctx.destination);
                osc.start();
                osc.stop(this.ctx.currentTime + duration);
            },
            shoot() { this.playTone(800, 'square', 0.1, 0.05); this.playTone(600, 'sawtooth', 0.1, 0.05); },
            explosion() { this.playTone(100, 'sawtooth', 0.3, 0.2); this.playTone(50, 'square', 0.5, 0.2); },
            damage() { this.playTone(200, 'sawtooth', 0.5, 0.3); }
        };

        function init() {
            // Audio.init() removed from here
            // Scene
            scene = new THREE.Scene();
            scene.fog = new THREE.FogExp2(0x000000, 0.002);

            // Camera
            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.z = 5;

            // Renderer
            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            document.body.appendChild(renderer.domElement);

            // Lights
            const ambientLight = new THREE.AmbientLight(0xffffff, 0.5);
            scene.add(ambientLight);

            const pointLight = new THREE.PointLight(0xffffff, 1);
            pointLight.position.set(10, 10, 10);
            scene.add(pointLight);

            // Starfield
            createStarfield();

            // Events
            window.addEventListener('resize', onWindowResize);
            document.addEventListener('mousemove', onMouseMove);
            document.addEventListener('mousedown', onMouseDown);

            renderer.render(scene, camera);
        }

        function createStarfield() {
            const geometry = new THREE.BufferGeometry();
            const vertices = [];
            for (let i = 0; i < 10000; i++) {
                vertices.push(
                    THREE.MathUtils.randFloatSpread(2000),
                    THREE.MathUtils.randFloatSpread(2000),
                    THREE.MathUtils.randFloatSpread(2000)
                );
            }
            geometry.setAttribute('position', new THREE.Float32BufferAttribute(vertices, 3));
            const material = new THREE.PointsMaterial({ color: 0xffffff, size: 0.7 });
            const stars = new THREE.Points(geometry, material);
            scene.add(stars);
        }

        function createAsteroid() {
            const geometry = new THREE.DodecahedronGeometry(Math.random() * 1 + 0.5, 0);
            const material = new THREE.MeshStandardMaterial({
                color: 0x888888,
                roughness: 0.8,
                flatShading: true
            });
            const asteroid = new THREE.Mesh(geometry, material);

            // Spawn far away at random position
            asteroid.position.x = (Math.random() - 0.5) * 50;
            asteroid.position.y = (Math.random() - 0.5) * 30;
            asteroid.position.z = -100;

            // Random rotation speed
            asteroid.userData = {
                rotX: Math.random() * 0.05,
                rotY: Math.random() * 0.05
            };

            scene.add(asteroid);
            asteroids.push(asteroid);
        }

        function createExplosion(position) {
            for (let i = 0; i < 10; i++) {
                const geometry = new THREE.BoxGeometry(0.2, 0.2, 0.2);
                const material = new THREE.MeshBasicMaterial({ color: 0xff4400 });
                const particle = new THREE.Mesh(geometry, material);

                particle.position.copy(position);
                particle.userData = {
                    velX: (Math.random() - 0.5) * 0.5,
                    velY: (Math.random() - 0.5) * 0.5,
                    velZ: (Math.random() - 0.5) * 0.5,
                    life: 1.0
                };

                scene.add(particle);
                particles.push(particle);
            }
        }

        function shootLaser() {
            // Raycast to find direction
            raycaster.setFromCamera(mouse, camera);
            const ray = raycaster.ray;

            // Create laser mesh
            const geometry = new THREE.CylinderGeometry(0.05, 0.05, 2, 8);
            geometry.rotateX(Math.PI / 2);
            const material = new THREE.MeshBasicMaterial({ color: 0x00ff00 });
            const laser = new THREE.Mesh(geometry, material);

            // Start at camera position (slightly below)
            laser.position.copy(camera.position);
            laser.position.y -= 0.5;

            // Set direction
            laser.lookAt(ray.at(100, new THREE.Vector3()));

            laser.userData = {
                velocity: ray.direction.clone().multiplyScalar(LASER_SPEED)
            };

            scene.add(laser);
            lasers.push(laser);
        }

        function onMouseMove(event) {
            mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
            mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;

            // Move crosshair visual
            const crosshair = document.getElementById('crosshair');
            crosshair.style.left = event.clientX + 'px';
            crosshair.style.top = event.clientY + 'px';

            // Slight camera movement for parallax
            camera.position.x = mouse.x * 2;
            camera.position.y = mouse.y * 2;
            camera.lookAt(0, 0, -20);
        }

        function onMouseDown() {
            if (isPlaying) { shootLaser(); Audio.shoot(); }
        }

        function update() {
            if (!isPlaying) return;

            // Spawn Asteroids
            if (Math.random() < 0.02 + (score * 0.0001)) createAsteroid();

            // Update Asteroids
            for (let i = asteroids.length - 1; i >= 0; i--) {
                const asteroid = asteroids[i];
                asteroid.position.z += ASTEROID_SPEED + (score * 0.001);
                asteroid.rotation.x += asteroid.userData.rotX;
                asteroid.rotation.y += asteroid.userData.rotY;

                // Check collision with player (camera plane)
                if (asteroid.position.z > 5) {
                    scene.remove(asteroid);
                    asteroids.splice(i, 1);
                    takeDamage(10); // Reduced damage from 20
                    Audio.damage();
                }
            }

            // Update Lasers
            for (let i = lasers.length - 1; i >= 0; i--) {
                const laser = lasers[i];
                laser.position.add(laser.userData.velocity);

                // Check collision with asteroids
                let hit = false;
                for (let j = asteroids.length - 1; j >= 0; j--) {
                    if (laser.position.distanceTo(asteroids[j].position) < 3) { // Increased hitbox from 2
                        // Hit!
                        createExplosion(asteroids[j].position);
                        scene.remove(asteroids[j]);
                        asteroids.splice(j, 1);
                        hit = true;
                        score += 50;
                        document.getElementById('score').innerText = 'SKOR: ' + score;
                        Audio.explosion();
                        break;
                    }
                }

                if (hit || laser.position.z < -150) {
                    scene.remove(laser);
                    lasers.splice(i, 1);
                }
            }

            // Update Particles
            for (let i = particles.length - 1; i >= 0; i--) {
                const p = particles[i];
                p.position.x += p.userData.velX;
                p.position.y += p.userData.velY;
                p.position.z += p.userData.velZ;
                p.userData.life -= 0.02;
                p.scale.setScalar(p.userData.life);

                if (p.userData.life <= 0) {
                    scene.remove(p);
                    particles.splice(i, 1);
                }
            }

            renderer.render(scene, camera);
            animationId = requestAnimationFrame(update);
        }

        function takeDamage(amount) {
            health -= amount;
            document.getElementById('health-fill').style.width = health + '%';

            // Screen shake effect (simple)
            document.body.style.transform = `translate(${Math.random() * 10 - 5}px, ${Math.random() * 10 - 5}px)`;
            setTimeout(() => document.body.style.transform = 'none', 100);

            if (health <= 0) gameOver();
        }

        function startGame() {
            Audio.init();
            if (Audio.ctx && Audio.ctx.state === 'suspended') Audio.ctx.resume();

            isPlaying = true;
            document.getElementById('start-screen').style.display = 'none';
            update();
        }

        function gameOver() {
            isPlaying = false;
            cancelAnimationFrame(animationId);
            document.getElementById('game-over').style.display = 'block';
            document.getElementById('final-score').innerText = score;
        }

        function resetGame() {
            score = 0;
            health = 100;
            document.getElementById('score').innerText = 'SKOR: 0';
            document.getElementById('health-fill').style.width = '100%';
            document.getElementById('game-over').style.display = 'none';

            // Clear scene objects
            asteroids.forEach(a => scene.remove(a));
            asteroids = [];
            lasers.forEach(l => scene.remove(l));
            lasers = [];
            particles.forEach(p => scene.remove(p));
            particles = [];

            startGame();
        }

        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }

        init();
    </script>
</body>

</html>